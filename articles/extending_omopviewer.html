<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extending OmopViewer • OmopViewer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extending OmopViewer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OmopViewer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Basic functionality</h6></li>
    <li><a class="dropdown-item" href="../articles/export_static_app.html">Create a static shiny app</a></li>
    <li><a class="dropdown-item" href="../articles/dynamic_app.html">Dynamic app</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Customisation</h6></li>
    <li><a class="dropdown-item" href="../articles/edit_static_content.html">Customise your static shiny</a></li>
    <li><a class="dropdown-item" href="../articles/background.html">Edit the landing page of your shiny</a></li>
    <li><a class="dropdown-item" href="../articles/theming.html">Theming your shiny</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Development</h6></li>
    <li><a class="dropdown-item" href="../articles/extending_omopviewer.html">Extending OmopViewer</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://dpa-pde-oxford.shinyapps.io/OmopViewerExample/">Example App</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extending OmopViewer</h1>
            
      

      <div class="d-none name"><code>extending_omopviewer.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/OmopViewer/">OmopViewer</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Do yo want <strong>OmopViewer</strong> to support more packages? This
is a developer focused vignette explaining the process to add new
default panels to the package.</p>
</div>
<div class="section level2">
<h2 id="what-lives-in-panels-r">1 What lives in <em>panels.R</em><a class="anchor" aria-label="anchor" href="#what-lives-in-panels-r"></a>
</h2>
<p><code>panels.R</code> builds <strong>one list</strong> –
<code>omopViewerPanels</code> – that the package ships as data. Every
element of that list is a <em>panel definition</em>. If you’ve read the
other vignette - Panels defined in OmopViewer - you’ve already seen this
structure in action. Here’s a quick recap:</p>
<table class="table">
<thead><tr class="header">
<th>key</th>
<th>purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>title</code></td>
<td>label shown in the sidebar</td>
</tr>
<tr class="even">
<td><code>icon</code></td>
<td>any free FontAwesome icon</td>
</tr>
<tr class="odd">
<td><code>data$result_type</code></td>
<td>string returned by your ETL / analyser</td>
</tr>
<tr class="even">
<td><code>automatic_filters</code></td>
<td>vector of column groups auto-exposed</td>
</tr>
<tr class="odd">
<td><code>filters</code></td>
<td>named list of picker / switch definitions</td>
</tr>
<tr class="even">
<td><code>content</code></td>
<td>tabs such as <code>tidy</code>, <code>table</code>,
<code>plot</code>, …</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">omopViewerPanels</span><span class="op">$</span><span class="va">summarise_omop_snapshot</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 6</span></span>
<span><span class="co">#&gt;  $ title            : chr "Snapshot"</span></span>
<span><span class="co">#&gt;  $ icon             : chr "clipboard-list"</span></span>
<span><span class="co">#&gt;  $ data             :List of 1</span></span>
<span><span class="co">#&gt;   ..$ result_type: chr "summarise_omop_snapshot"</span></span>
<span><span class="co">#&gt;  $ automatic_filters: chr "variable_name"</span></span>
<span><span class="co">#&gt;  $ filters          :List of 1</span></span>
<span><span class="co">#&gt;   ..$ cdm_name:List of 7</span></span>
<span><span class="co">#&gt;  $ content          :List of 2</span></span>
<span><span class="co">#&gt;   ..$ tidy :List of 6</span></span>
<span><span class="co">#&gt;   ..$ table:List of 5</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "omopviewer_panel"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-a-new-panel">2 Add a new panel<a class="anchor" aria-label="anchor" href="#add-a-new-panel"></a>
</h2>
<p>Edit <em>panels.R</em> <strong>above</strong> the “all panels” block.
Here I use SamplePkg::tablefunction and SamplePkg::plotfunction as a
placeholder for the plot and table functions developer should add.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## my custom summary ----</span></span>
<span><span class="va">myCustomPanel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># --- metadata -----------------------------------------------------------</span></span>
<span>  title  <span class="op">=</span> <span class="st">"My Custom"</span>,</span>
<span>  icon   <span class="op">=</span> <span class="st">"wand-magic-sparkles"</span>,</span>
<span>  data   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>result_type <span class="op">=</span> <span class="st">"summarise_my_custom"</span><span class="op">)</span>,</span>
<span>  automatic_filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group"</span>, <span class="st">"strata"</span>, <span class="st">"variable_name"</span>, <span class="st">"settings"</span><span class="op">)</span>,</span>
<span>  filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cdm_name <span class="op">=</span> <span class="va">cdmFilter</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># --- UI tabs ------------------------------------------------------------</span></span>
<span>  content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    tidy <span class="op">=</span> <span class="va">tidyContent</span>,</span>
<span>    </span>
<span>    table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      title       <span class="op">=</span> <span class="st">"Table Sample"</span>,</span>
<span>      output_type <span class="op">=</span> <span class="st">"gt"</span>,</span>
<span>      reactive    <span class="op">=</span> <span class="st">"&lt;filtered_data&gt; |&gt; SamplePkg::tablefunction("</span>,</span>
<span>      render      <span class="op">=</span> <span class="st">"&lt;reactive_data&gt;"</span>,</span>
<span>      filters <span class="op">=</span> <span class="fu">rankTableButton</span><span class="op">(</span></span>
<span>        none        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt;strata&gt;"</span>, <span class="st">"estimate_name"</span><span class="op">)</span>,</span>
<span>        header      <span class="op">=</span> <span class="st">"variable_name"</span>,</span>
<span>        groupColumn <span class="op">=</span> <span class="st">"cdm_name"</span>,</span>
<span>        hide        <span class="op">=</span> <span class="st">"variable_level"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      download <span class="op">=</span> <span class="fu">downloadGtTable</span><span class="op">(</span><span class="st">"table_sample"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    </span>
<span>    plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      title       <span class="op">=</span> <span class="st">"Plot Sample"</span>,</span>
<span>      output_type <span class="op">=</span> <span class="st">"ui"</span>,</span>
<span>      reactive    <span class="op">=</span> <span class="st">"&lt;filtered_data&gt; |&gt; SamplePkg::plotfunction(facet = input$facet)"</span>,</span>
<span>      render      <span class="op">=</span> <span class="st">"renderInteractivePlot(&lt;reactive_data&gt;, input$interactive)"</span>,</span>
<span>      filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        interactive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          button_type <span class="op">=</span> <span class="st">"materialSwitch"</span>,</span>
<span>          label <span class="op">=</span> <span class="st">"Interactive"</span>,</span>
<span>          value <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span>,</span>
<span>        facet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          button_type <span class="op">=</span> <span class="st">"pickerInput"</span>,</span>
<span>          label <span class="op">=</span> <span class="st">"Facet"</span>,</span>
<span>          choices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">'cdm_name'</span>, <span class="st">'&lt;group&gt;'</span>, <span class="st">'&lt;strata&gt;'</span>, <span class="st">'&lt;additional&gt;'</span>, <span class="st">'&lt;settings&gt;'</span></span>
<span>          <span class="op">)</span>,</span>
<span>          selected <span class="op">=</span> <span class="st">'cdm_name'</span>,</span>
<span>          multiple <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      download <span class="op">=</span> <span class="fu">downloadPlot</span><span class="op">(</span><span class="st">"plot_sample.png"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Key points for developers</strong></p>
<ul>
<li>
<strong>Always add both <code>table</code> and <code>plot</code>
nodes</strong> (unless your package really has no plot).</li>
<li>Use the standard helper objects: <code>tidyContent</code>,
<code>rankTableButton()</code>, <code>downloadGtTable()</code>,
<code>downloadPlot()</code>.</li>
<li>Place the new list <em>above</em> the
<code>omopViewerPanels &lt;- list(...)</code> block, then register
it:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">omopViewerPanels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># existing entries …</span></span>
<span>  summarise_my_custom <span class="op">=</span> <span class="va">myCustomPanel</span>,</span>
<span>  <span class="co"># default</span></span>
<span>  default <span class="op">=</span> <span class="va">defaultPanel</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">newOmopViewerPanel</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Run <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all()</a></code>; the static viewer will now
include <strong>My Custom</strong>.</p>
<hr>
<p>Commit, tag, release. Done.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martí Català, Yuchen Guo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
